<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CIMENCAM ‚Äî HSE Days</title>
  <meta name="description" content="Acc√®s Survey et Playlist HSE Days de CIMENCAM." />
  <meta name="theme-color" content="#0E7C57" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --green:#0E7C57; --green-dark:#1B5E20; --orange:#F39C12;
      --bg:#F8FAF9; --text:#2E2E2E; --card:#ffffff;
    }
    *{box-sizing:border-box} html,body{margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
    .wrap{max-width:960px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;padding:16px 0 8px;border-bottom:3px solid rgba(14,124,87,.15)}
    .logo{width:64px;height:64px;border-radius:12px;object-fit:cover;background:#e6efe9;border:2px solid rgba(14,124,87,.25)}
    h1{margin:0;font-weight:800;color:var(--green);letter-spacing:.2px}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;background:rgba(243,156,18,.12);color:var(--orange);border:1px solid rgba(243,156,18,.35);margin-top:6px}
    .hero{padding:18px 0 6px}.hero p{margin:.3rem 0;font-size:1.05rem}
    .grid{display:grid;gap:16px;grid-template-columns:1fr;margin-top:16px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid rgba(0,0,0,.06);border-radius:18px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,.06)}
    .card h2{margin-top:0;color:var(--green-dark)}
    .pill{display:inline-block;font-size:.8rem;padding:4px 10px;border-radius:999px;margin-bottom:8px;background:rgba(14,124,87,.08);color:var(--green-dark);border:1px solid rgba(14,124,87,.25);font-weight:600}
    .btn{display:inline-block;width:100%;text-align:center;text-decoration:none;padding:14px 18px;border-radius:14px;font-weight:800;letter-spacing:.3px;transition:transform .06s ease,box-shadow .2s ease,opacity .2s ease;border:2px solid transparent;cursor:pointer}
    .btn:hover{transform:translateY(-1px);box-shadow:0 8px 18px rgba(0,0,0,.08)}
    .btn-primary{background:var(--green);color:#fff}
    .btn-secondary{background:#fff;color:var(--green-dark);border-color:rgba(27,94,32,.35)}
    .note{margin-top:18px;font-size:.94rem;color:#4a4a4a;background:#fff;border:1px dashed rgba(14,124,87,.35);border-radius:14px;padding:12px 14px}
    .divider{height:1px;background:linear-gradient(to right,transparent,rgba(14,124,87,.25),transparent);margin:18px 0}
    footer{margin:28px 0 8px;padding-top:14px;font-size:.9rem;color:#616161;text-align:center;border-top:1px solid rgba(0,0,0,.07)}

    /* === Modal Playlist === */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
    .modal{max-width:900px;width:100%;background:#fff;border-radius:18px;box-shadow:0 18px 60px rgba(0,0,0,.25);border:1px solid rgba(0,0,0,.08);overflow:hidden}
    .modal-header{display:flex;align-items:center;gap:12px;padding:16px 18px;border-bottom:1px solid rgba(0,0,0,.06);background:linear-gradient(180deg,rgba(14,124,87,.08),transparent)}
    .modal-title{font-weight:800;color:var(--green-dark);margin:0}
    .modal-body{padding:16px 18px}
    .row{display:grid;gap:16px;grid-template-columns:1fr}
    @media(min-width:860px){.row{grid-template-columns:1.1fr .9fr}}
    .panel{border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:14px}
    .controls{display:flex;gap:8px;align-items:center;margin:8px 0 10px}
    .mini{width:auto;padding:10px 14px;border-radius:12px}
    #seek{width:100%;appearance:none;height:8px;border-radius:6px;background:linear-gradient(to right,var(--green) 0%,var(--green) 0%,#ddd 0%);border:1px solid rgba(0,0,0,.08)}
    #trackList{list-style:none;padding-left:0;margin:0}
    #trackList li{padding:10px 12px;border:1px solid rgba(0,0,0,.06);border-radius:10px;margin-bottom:8px;cursor:pointer;background:#fff;display:flex;align-items:center;gap:8px}
    #trackList li.active{background:rgba(14,124,87,.08);border-color:rgba(14,124,87,.35)}
    .close-x{margin-left:auto;background:transparent;border:none;font-size:22px;line-height:1;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img class="logo" src="https://share.google/images/T2zsXHZMLmRbocWPF" alt="CIMENCAM logo" onerror="this.style.display='none'">
      <div>
        <h1>CIMENCAM ‚Äî HSE Days</h1>
        <div class="tag">S√©curit√© ‚Ä¢ Sant√© ‚Ä¢ Environnement</div>
      </div>
    </header>

    <section class="hero">
      <p>Bienvenue ! Dans le cadre des <strong>HSE Days</strong>, choisissez votre action :</p>
      <ul>
        <li><strong>üìù Remplir le survey</strong> pour partager vos id√©es & priorit√©s HSE</li>
        <li><strong>üéß √âcouter la playlist</strong> des HSE Days (lecture directe dans le navigateur)</li>
      </ul>
      <div class="divider"></div>
    </section>

    <section class="grid">
      <article class="card">
        <span class="pill">√âtape 1</span>
        <h2>üìù Remplir le Survey (3‚Äì5 min)</h2>
        <p>Contribuez √† renforcer notre culture <em>s√©curit√© & sant√© au travail</em>.</p>
        <a class="btn btn-primary" href="https://drive.google.com/file/d/1KPt32GxsKTqqp0baPmssp64oY6sXDJFu/view?usp=sharing" target="_blank" rel="noopener">Remplir le survey</a>
        <p class="note">‚ö†Ô∏è Conseil : connectez-vous √† votre compte professionnel si requis par l‚Äôentreprise.</p>
      </article>

      <article class="card">
        <span class="pill">√âtape 2</span>
        <h2>üéß Acc√©der √† la Playlist HSE</h2>
        <p>Plongez dans l‚Äôambiance avec une s√©lection musicale d√©di√©e.</p>
        <button id="openPlaylist" class="btn btn-secondary">√âcouter la playlist</button>
        <p class="note">‚ÑπÔ∏è Les pistes sont h√©berg√©es sur ce site (Vercel) pour une lecture fluide.</p>
      </article>
    </section>

    <footer>
      <p>¬© CIMENCAM ‚Äî HSE Days ‚Ä¢ #HSEdays #S√©curit√© #Sant√© #Ensemble</p>
    </footer>
  </div>

  <!-- ===== MODAL PLAYLIST ===== -->
  <div class="modal-backdrop" id="playlistModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">üé∂ Playlist HSE Days</h3>
        <button class="close-x" id="closePlaylist" title="Fermer">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="panel">
            <div class="controls">
              <button id="prevBtn" class="btn btn-secondary mini">‚èÆÔ∏è Pr√©c√©dent</button>
              <button id="playPauseBtn" class="btn btn-primary mini">‚ñ∂Ô∏è Lecture</button>
              <button id="nextBtn" class="btn btn-secondary mini">‚è≠Ô∏è Suivant</button>
              <div id="nowPlaying" style="margin-left:auto;font-weight:700;color:var(--green-dark)">En attente‚Ä¶</div>
            </div>
            <input id="seek" type="range" min="0" max="100" value="0" step="0.1"/>
          </div>
          <div class="panel">
            <ul id="trackList"></ul>
            <p class="note" id="hint">üí° Astuce : cliquez un titre pour le lire. Les morceaux s‚Äôencha√Ænent automatiquement.</p>
          </div>
        </div>
      </div>
      <!-- Lecteur audio (unique, cach√©) -->
      <audio id="audio" preload="metadata"></audio>
    </div>
  </div>

  <script>
  // --- Ouverture/fermeture du modal
  const modal = document.getElementById('playlistModal');
  document.getElementById('openPlaylist').addEventListener('click', ()=>{ modal.style.display='flex'; });
  document.getElementById('closePlaylist').addEventListener('click', ()=>{ modal.style.display='none'; });

  // --- Lecteur & playlist auto depuis songs/songs.json
  (async function(){
    const audio = document.getElementById('audio');
    const now = document.getElementById('nowPlaying');
    const list = document.getElementById('trackList');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const seek = document.getElementById('seek');

    let tracks = [];
    try{
      const res = await fetch('songs/songs.json', {cache:'no-store'});
      tracks = await res.json();
    }catch(e){
      list.innerHTML = '<li style="color:#b00020">Aucune playlist trouv√©e (songs/songs.json manquant).</li>';
      return;
    }
    if(!Array.isArray(tracks) || tracks.length===0){
      list.innerHTML = '<li style="color:#b00020">La playlist est vide. Ajoutez vos MP3 dans /songs puis reg√©n√©rez songs.json.</li>';
      return;
    }

    let index = 0, isPlaying = false;

    // Construit la liste
    list.innerHTML = '';
    tracks.forEach((t, i) => {
      const li = document.createElement('li');
      li.innerHTML = `üéµ <strong>${t.title || t.file}</strong>`;
      li.addEventListener('click', () => load(i, true));
      list.appendChild(li);
    });

    function highlight(){
      [...list.children].forEach((li, i) => {
        li.classList.toggle('active', i===index);
      });
    }
    function updateSeekBg(p){ seek.style.background = `linear-gradient(to right, var(--green) ${p}%, #ddd ${p}%)`; }

    function load(i, autoplay=false){
      index = i;
      audio.src = `songs/${tracks[index].file}`;
      now.textContent = `En lecture : ${tracks[index].title || tracks[index].file}`;
      highlight();
      if (autoplay) play();
    }
    function play(){ audio.play(); isPlaying=true; playPauseBtn.textContent='‚è∏Ô∏è Pause'; playPauseBtn.classList.remove('btn-primary'); playPauseBtn.classList.add('btn-secondary'); }
    function pause(){ audio.pause(); isPlaying=false; playPauseBtn.textContent='‚ñ∂Ô∏è Lecture'; playPauseBtn.classList.remove('btn-secondary'); playPauseBtn.classList.add('btn-primary'); }

    playPauseBtn.addEventListener('click', ()=> isPlaying ? pause() : play());
    prevBtn.addEventListener('click', ()=> { index=(index-1+tracks.length)%tracks.length; load(index, true); });
    nextBtn.addEventListener('click', ()=> { index=(index+1)%tracks.length; load(index, true); });

    audio.addEventListener('ended', ()=>{ index=(index+1)%tracks.length; load(index, true); });
    audio.addEventListener('timeupdate', ()=> {
      if (!audio.duration) return;
      const p = (audio.currentTime / audio.duration) * 100;
      seek.value = p; updateSeekBg(p);
    });
    seek.addEventListener('input', (e)=> {
      if (!audio.duration) return;
      const p = parseFloat(e.target.value);
      audio.currentTime = (p / 100) * audio.duration;
      updateSeekBg(p);
    });

    // Charger la premi√®re piste
    load(0, false);
  })();
  </script>
</body>
</html>
